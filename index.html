<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alfabetet</title>
  <style>
    html, body { width: 100%; height: 100%; margin: 0; padding: 0; }
    body {
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
      background-color: #f0f0f0; font-family: Arial, sans-serif; color: #333; padding-top: 2vmin;
      position: relative;
    }
    #instruction { font-size: 3vmin; text-align: center; margin-bottom: 1vmin; padding: 0 1vmin; }
    #display {
      font-size: 50vmin; font-weight: bold; text-align: center; margin: 0; padding: 0;
      user-select: none; flex-grow: 1; display: flex; align-items: center; justify-content: center;
      width: 100%; height: auto;
    }
    #message, #leaderboard { font-size: 4vmin; margin-top: 1vmin; text-align: center; }
    #name-input, #start-button, #restart-button { font-size: 4vmin; margin: 0.5vmin; }
    #leaderboard ul { list-style: none; padding: 0; margin: 0.5vmin 0; }
    #leaderboard li { margin: 0.2vmin 0; }
    #watermark {
      position: fixed; bottom: 1vmin; right: 1vmin; font-size: 2vmin;
      color: rgba(0,0,0,0.3); pointer-events: none; user-select: none;
    }
  </style>
</head>
<body>
  <div id="instruction">Du skal skrive alfabetet så fort du kan. Havner du blant topp 5 denne uken?</div>
  <div id="display"></div>
  <div id="message">Skriv inn navn:</div>
  <input id="name-input" type="text" placeholder="Navn" autofocus />
  <button id="start-button">Start</button>
  <button id="restart-button" style="display:none;">Spill igjen</button>
  <div id="leaderboard"></div>
  <div id="watermark">LektorAntonsen2025</div>

  <script>
    <!-- KONFIGURASJON: Sett inn GIST_ID og GITHUB_TOKEN rett under -->
    <!-- Eksempel: const GIST_ID = '8ddf0d6a9d69c4eb7ef384149bc36ff8'; -->
    <!--           const GITHUB_TOKEN = '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'; -->
    (async function() {
      // Konfigurasjon for GitHub Gist
      const GIST_ID = 'DIN_GIST_ID_HER';
      const GITHUB_TOKEN = 'DIN_PERSONLIGE_TOKEN_HER';

      // Hent og oppdater highscore via GitHub Gist
      async function loadBoard() {
        const res = await fetch(`https://api.github.com/gists/${GIST_ID}`);
        const gist = await res.json();
        const content = gist.files['scores.json'].content;
        return JSON.parse(content);
      }
      async function saveBoard(board) {
        await fetch(`https://api.github.com/gists/${GIST_ID}`, {
          method: 'PATCH',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `token ${GITHUB_TOKEN}`
          },
          body: JSON.stringify({ files: { 'scores.json': { content: JSON.stringify(board, null, 2) } } })
        });
      }
      function getLastSunday20() {
        const now = new Date();
        const day = now.getDay();
        let last = new Date(now);
        last.setDate(now.getDate() - day);
        last.setHours(20,0,0,0);
        if (last > now) last.setDate(last.getDate() - 7);
        return last;
      }

      // Weekly reset handler (maintained in gist data)
      async function resetIfNeeded(board) {
        const threshold = getLastSunday20().getTime();
        if (!board.lastReset || board.lastReset < threshold) {
          board.entries = board.defaultEntries;
          board.lastReset = threshold;
          await saveBoard(board);
        }
      }

      // Initial loading
      const displayEl = document.getElementById('display');
      const messageEl = document.getElementById('message');
      const nameInput = document.getElementById('name-input');
      const startButton = document.getElementById('start-button');
      const restartButton = document.getElementById('restart-button');
      const leaderboardEl = document.getElementById('leaderboard');

      let alfabet = [..."abcdefghijklmnopqrstuvwxyzæøå"];
      let index = 0, startTime = null, userName = '';

      // Fetch initial board object
      let boardData = await loadBoard();
      // If gist doesn't include defaultEntries or lastReset, initialize
      boardData.defaultEntries = boardData.defaultEntries || [
        {name:'Ola', time:210},{name:'Kari', time:220},{name:'Per', time:230},{name:'Marit', time:240},{name:'Espen', time:250}
      ];
      await resetIfNeeded(boardData);

      function renderBoard(entries) {
        leaderboardEl.innerHTML = '<div>Topp 5 denne uken</div><ul>' +
          entries.map(e => `<li>${e.name}: ${e.time.toFixed(1)}s</li>`).join('') + '</ul>';
      }
      renderBoard(boardData.entries);

      function showLetter(letter) {
        messageEl.textContent = '';
        displayEl.textContent = letter;
      }
      async function endGame(elapsed) {
        displayEl.textContent = '';
        messageEl.textContent = `Gratulerer ${userName}! Du brukte ${elapsed.toFixed(1)} sekunder.`;
        // Oppdater boardData
        boardData.entries.push({name:userName, time:elapsed});
        boardData.entries.sort((a,b)=>a.time-b.time);
        boardData.entries = boardData.entries.slice(0,5);
        await saveBoard(boardData);
        renderBoard(boardData.entries);
        restartButton.style.display = '';
      }

      function startGame() {
        userName = nameInput.value.trim()||'Ukjent';
        nameInput.style.display='none'; startButton.style.display='none'; restartButton.style.display='none';
        index=0; startTime=Date.now(); showLetter(alfabet[index]);
      }
      startButton.addEventListener('click', startGame);
      restartButton.addEventListener('click', ()=>{ index=0; startTime=Date.now(); restartButton.style.display='none'; showLetter(alfabet[index]); });

      document.body.addEventListener('keydown', async e=>{
        if(startTime===null) return;
        const key=e.key.toLowerCase();
        if(key===alfabet[index]){
          index++;
          if(index<alfabet.length){ showLetter(alfabet[index]); }
          else { const elapsed=(Date.now()-startTime)/1000; startTime=null; await endGame(elapsed); }
        }
      });
    })();
  </script>
</body>
</html>
